{% extends 'base.html' %}
{% block content %}
    
    <h1>{{ trip.trip_name }}: All the infos!</h1>

    <br>

    <h3>All the peoples
        <ul>
            {% for usertrip in trip.usertrips %}
            <li>
                {{ usertrip.user.user_name }}
            </li>
            {% endfor %}
        </ul>
    </h3>

    <a href="/trip/{{ trip.trip_id }}/search">Searches the stuffs</a>

    <br>

    <a href="/trip/{{ trip.trip_id }}/share">Sharing all the trips!</a>

    <p>All stuffs in here based on search results and whatnots</p>

    {% for usertrip in trip.usertrips %}
    {% if usertrip.user_id == session["user_id"] %}
        <p id="votedForOption">You voted for option: {{ usertrip.option_vote }}</p>
    {% endif %}
    {% endfor %}

    <!-- Trigger/Open The Modal -->
    <button id="vote">Vote for Option</button>

    <!-- The Modal -->
    <div id="myModal" class="modal">

      <!-- Modal content -->
      <div class="modal-content">
        <span class="close">x</span>
        <form id="option-vote">
        {% for option in options %}
        <br>
        <input class="options" type="radio" name="vote-option" value="{{ option.option_id }}"></input>
        <span style="font-size: 24px"><strong>Option {{ option.option_id }}: Traveling to {{ option.destination_airport.airport_city }} from {{ option.depart_date }} to {{ option.return_date }}</strong></span>
            {% for flight in option.flights %}
            {% for leg in flight.legs %}
            {% if leg.origin_airport_code == user.origin_airport_code %}
            <h4>Flight: {{ flight.flight_id }} Price: {{ flight.flight_price }}</h4>
            <table>
                <thead>
                    <th>
                        <td>Origin Airport</td>
                        <td>Departure Datetime</td>
                        <td>Destination Airport</td>
                        <td>Arrival Time</td>
                        <td>Flight ID</td>
                        <td>Flight Duration</td>
                    </th>
                </thead>
                <tbody>
                    <tr>
                        <td>{{ leg.origin_airport_code }}</td>
                        <td>{{ leg.departure_datetime }}</td>
                        <td>{{ leg.destination_airport_code }}</td>
                        <td>{{ leg.arrival_datetime }}</td>
                        <td>{{ leg.leg_airline }} {{ leg.leg_flight_code }}</td>
                        <td>{{ leg.leg_duration }}</td>
                    </tr>
                </tbody>
                {% endif %}
                {% endfor %}
            </table>
            {% endfor %}
        {% endfor %}
        <br>
        <input type="submit" value="vote">
        </form>
      </div>

    </div>

    <br>

    {% for option in options %}
    <br>
    <span style="font-size: 24px"><strong>Option {{ option.option_id }}: Traveling to {{ option.destination_airport.airport_city }} from {{ option.depart_date }} to {{ option.return_date }}</strong></span>
        {% for flight in option.flights %}
        <h4>Flight: {{ flight.flight_id }} Price: {{ flight.flight_price }}</h4>
        <table>
            <thead>
                <th>
                    <td>Origin Airport</td>
                    <td>Departure Datetime</td>
                    <td>Destination Airport</td>
                    <td>Arrival Time</td>
                    <td>Flight ID</td>
                    <td>Flight Duration</td>
                </th>
            </thead>
            {% for leg in flight.legs %}
            <tbody>
                <tr>
                    <td>{{ leg.origin_airport_code }}</td>
                    <td>{{ leg.departure_datetime }}</td>
                    <td>{{ leg.destination_airport_code }}</td>
                    <td>{{ leg.arrival_datetime }}</td>
                    <td>{{ leg.leg_airline }} {{ leg.leg_flight_code }}</td>
                    <td>{{ leg.leg_duration }}</td>
                </tr>
            </tbody>
            {% endfor %}
        </table>
        {% endfor %}
    {% endfor %}

    <script type="text/javascript">
        // Get the modal
        var modal = document.getElementById('myModal');

        // Get the button that opens the modal
        var btn = document.getElementById("vote");

        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];

        // When the user clicks on the button, open the modal 
        btn.onclick = function() {
            modal.style.display = "block";
        }

        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
            modal.style.display = "none";
        }

        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
            if (event.target == modal) {
                modal.style.display = "none";
            }
        }
    </script>

    <script type="text/javascript">
        function showConfirmation(result) {
            $("#myModal").hide();
            $("#votedForOption").val(voted_option_id)
        }

        function voteOption(evt) {
            evt.preventDefault();

            var voted_option_id = $(".options:checked").val();      

            $("#votedForOption").text("You voted for option: " + voted_option_id)
            // debugger;
            $.post("/trip/{{ trip.trip_id }}/option-vote", 
                  {"voted_option_id": voted_option_id}, 
                  showConfirmation
                  );
        }

        $("#option-vote").on("submit", voteOption);
    </script>

{% endblock %}

